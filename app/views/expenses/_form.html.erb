<%= form_for(expense, remote: true) do |f| %>

  <% if expense.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(expense.errors.count, "error") %> prohibited this expense from being saved:</h2>

      <ul>
      <% expense.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <script type="text/javascript">
    $('form#new_expense').on('ajax:success', function(event, data, xhr, status) {
      var $form = $(this);
      $("#error-div").addClass("hidden");
    });
    $('form#new_expense').on('ajax:error', function(event, data, xhr, status) {
      console.log(data.responseText);
      $("#error-div").removeClass("hidden");
    });
  </script>

    <div class="panel panel-default">
      <div class="panel-heading"><svg class="glyph stroked email"><use xlink:href="#stroked-email"></use></svg> New Request</div>
        <div class="panel-body">
          <form class="form-horizontal" action="" method="post">
            <fieldset>
              <div id="error-div" class="alert bg-danger hidden" role="alert">
                 <svg class="glyph stroked cancel"><use xlink:href="#stroked-cancel"></use></svg>All Fields Are Required <a href="#" class="pull-right"></a>
              </div>
              <div id="success-div" class="alert bg-success hidden" role="alert">
                 <svg class="glyph stroked cancel"><use xlink:href="#stroked-cancel"></use></svg>Success<a href="#" class="pull-right"></a>
              </div>
              <!-- Name input-->
              <div class="form-group">
                <%= f.label :name ,:class => 'col-md-3 control-label' %>
                <div class="col-md-9">
                  <%= f.text_field :name, style: 'margin-bottom:15px;', :class => 'form-control' %>
                </div>
              </div>

              <!-- Amount input-->
              <div class="form-group">
                <%= f.label :amount ,:class => 'col-md-3 control-label' %>
                <div class="col-md-9">
                    <%= f.number_field :amount,style: 'margin-bottom:15px;',:id => 'amount', :class => 'form-control', :step => 0.01 ,:value => 0 %>
                </div>
              </div>

              <!-- Quantity input-->
              <div class="form-group">
                <%= f.label :quantity ,:class => 'col-md-3 control-label' %>
                <div class="col-md-9">
                    <%= f.number_field :quantity,style: 'margin-bottom:15px;', :id => 'quantity',:class => 'form-control', :value => 1 %>
                </div>
              </div>

              <div class="form-group">
                <%= f.label :unit ,:class => 'col-md-3 control-label' %>
                <div class="col-md-9">
                    <%= f.collection_select :unit, StoredUnit.all,:name, :name, {prompt: true} ,{class: 'form-control', style: 'margin-bottom:15px;'} %>
                </div>
              </div>

               <div class="form-group">
                <%= f.label :category ,:class => 'col-md-3 control-label' %>
                <div class="col-md-9">
                    <%= f.collection_select :category, ExpenseType.all,:name, :name, {prompt: true} ,{class: 'form-control', style: 'margin-bottom:15px;'} %>
                </div>
              </div>


              <div class="form-group">
                <%= f.label :desc,:class => 'col-md-3 control-label' %>
                <div class="col-md-9">
                    <%= f.text_area :description, style: 'margin-bottom:15px;', :class => 'form-control' %>
                </div>
              </div>

               <div class="form-group">
                <%= f.label :total ,:class => 'col-md-3 control-label' %>
                <div class="col-md-9">
                    <input id="total" type="number" class="form-control" readonly style='margin-bottom:15px;' />
                </div>
              </div>


              <script type="text/javascript">

                $("#amount").keyup(multiply);
                $("#quantity").keyup(multiply);

                function multiply() {
                  console.log("triggered");
                  var quantity = parseFloat($("#quantity").val());
                  var amount = parseFloat($("#amount").val());
                  if (!isNaN(quantity) && !isNaN(amount)) { 
                    $("#total").val(quantity * amount);
                  } else {
                    $("#total").val("not a number?");
                  }
                }

              </script>

                <!-- Form actions -->
                <div class="form-group">
                  <div class="col-md-12 widget-right">
                         <%= f.submit 'Submit', :class => 'btn btn-default btn-md pull-right' %>
                  </div>
                </div>


              </fieldset>
            </form>
          </div>
         </div>
<% end %>
